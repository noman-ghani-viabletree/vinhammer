jQuery((function(a){"use strict";var i={init:function(){a("#woocommerce-product-data").on("woocommerce_variations_loaded",(function(){a(".woocommerce_variation").each((function(){var t=a(this);i.single_gallery_init(t)})),i.init_upload()})),a("#variable_product_options").on("woocommerce_variations_added",(function(){a(".woocommerce_variation").each((function(){var t=a(this);i.single_gallery_init(t)})),i.init_upload()}))},init_upload:function(){var t={};a(".add_variation_images").on("click","a",(function(e){var o=a(this),n=o.data("product_variation_id"),r=o.closest(".kwsv-variations-images-wrapper"),l=r.find("ul.kwsv-gallery-list"),c=r.find(".kwsv_gallery_images");e.preventDefault(),t[n]||(t[n]=wp.media.frames.product_gallery=wp.media({title:o.data("choose"),button:{text:o.data("update")},states:[new wp.media.controller.Library({title:o.data("choose"),filterable:"all",multiple:!0})]}),t[n].on("select",(function(){var a=t[n].state().get("selection"),e=c.val();a.map((function(a){if((a=a.toJSON()).id){e=e?e+","+a.id:a.id;var i=a.sizes&&a.sizes.thumbnail?a.sizes.thumbnail.url:a.url;l.append('<li class="image" data-attachment-id="'+a.id+'"><img src="'+i+'" /><ul class="actions"><li><a href="#" class="delete" title="'+o.data("delete")+'">'+o.data("text")+"</a></li></ul></li>")}})),c.val(e),i.variation_changed(r)}))),t[n].open()}))},single_gallery_init:function(t){var e=t.find(".options:first"),o=t.find(".kwsv-variations-images-wrapper");o.insertBefore(e);var n=o.find("ul.kwsv-gallery-list"),r=o.find(".kwsv_gallery_images");n.sortable({items:"li.image",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(a,i){i.item.css("background-color","#f6f6f6")},stop:function(a,i){i.item.removeAttr("style")},update:function(){var t="";o.find("ul li.image").css("cursor","default").each((function(){var i=a(this).attr("data-attachment-id");console.log(i),t=t?t+","+i:i})),r.val(t),i.variation_changed(o)}}),o.on("click","a.delete",(function(){a(this).closest("li.image").remove(),console.log(a(this));var t="";return n.find("li.image").css("cursor","default").each((function(){var i=a(this).attr("data-attachment-id");t=t?t+","+i:i})),console.log(t),r.val(t),i.variation_changed(o),!1}))},variation_changed:function(i){a(i).closest(".woocommerce_variation").addClass("variation-needs-update"),a("button.cancel-variation-changes, button.save-variation-changes").removeAttr("disabled"),a("#variable_product_options").trigger("woocommerce_variations_input_changed")}};i.init()}));